
package com.etantolling.fastlane.sandag.tcs.wsdl.transaction;

import java.io.File;
import java.io.IOException;
import java.net.URL;
import java.util.GregorianCalendar;
import java.util.LinkedHashMap;
import java.util.List;

import javax.xml.datatype.DatatypeFactory;
import javax.xml.datatype.XMLGregorianCalendar;
import javax.xml.namespace.QName;

import org.apache.commons.io.FileUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import com.etantolling.testrunner.test.core.testing.ITestEventRunner;
import com.etantolling.testrunner.test.core.testing.TestInputFile;
import com.etantolling.testrunner.test.core.testing.TestParameterList;
import com.etantolling.testrunner.test.core.testing.Wildcards;
import com.fasterxml.jackson.core.JsonParseException;
import com.fasterxml.jackson.databind.JsonMappingException;
import com.fasterxml.jackson.databind.ObjectMapper;

/**
 * This class was generated by Apache CXF 3.2.2 2018-03-22T12:23:47.143+01:00
 * Generated source version: 3.2.2
 *
 */
public final class TransactionPort_Sandag_Client implements ITestEventRunner {
	private static final Logger logger = LoggerFactory.getLogger(TransactionPort_Sandag_Client.class);
	private static final QName SERVICE_NAME = new QName("http://transaction.wsdl.tcs.sandag.fastlane.etantolling.com",
			"TransactionPortService");
	private String tennantname;
	
	public TransactionPort_Sandag_Client(String tennantName) {
	   
	}
	
	public TransactionPort_Sandag_Client() {
	   
	}

	public static void main(String args[]) throws java.lang.Exception {                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             

		URL wsdlURL = new URL("http://localhost:8080/ws/transaction.wsdl");
		
		
		TransactionPortService ss = new TransactionPortService(wsdlURL);
		TransactionPort port = ss.getTransactionPortSoap11();

		{
			System.out.println("Invoking tollTransaction...");
			com.etantolling.fastlane.sandag.tcs.wsdl.transaction.TollTransactionRequest request = new TollTransactionRequest();

			GregorianCalendar gregorianCalendar = new GregorianCalendar();
			DatatypeFactory datatypeFactory = DatatypeFactory.newInstance();
			XMLGregorianCalendar now = datatypeFactory.newXMLGregorianCalendar(gregorianCalendar);

			request.setFacilityCode("1");
			request.setPlazaCode("1");
			request.setLaneNumber(1);
			request.setTransactionDateTime(now);

			request.setExitFacilityCode("1");
			request.setExitPlazaCode("1");
			request.setExitLaneNumber(1);
			request.setExitTransactionDateTime(now);

			request.setSequenceNumber(1000);
			request.setTransactionType("AVI");
			request.setAVCClassification("1");
			request.setCSCClassification("1");

			request.setLaneMode("V");
			request.setAxleCount(2);

			com.etantolling.fastlane.sandag.tcs.wsdl.transaction.TollTransactionResponse response = port
					.tollTransaction(request);
			System.out.println("tollTransaction.result=" + response);

		}
		System.exit(0);
	}

	@Override
	public LinkedHashMap<String, Object> runEvent(TestParameterList params, LinkedHashMap<String, Object> storeValues,
			String testBaseUrl, String appBaseUrl, String appjobUrl) throws Exception {

		String url = params.getString(params.getInputValues(), "URL");
		
		tennantname=(String) storeValues.get("tennantname");
		
		
		if(null!=params.getInputFiles() && params.getInputFiles().size()>0) {
		   for (TestInputFile file: params.getInputFiles()  ) {
			   
			   
			   File fileJson=new File("tmp.json");
			   URL jUrl=file.getUrl();
			   //if(!jUrl.contains("https://"))
				//   jUrl=   jUrl.replaceAll("https:/","https://" );
			   //FileUtils.copyURLToFile(new URL(jUrl),fileJson );
			   FileUtils.copyURLToFile(jUrl,fileJson );
			   
			   String json =FileUtils.readFileToString(fileJson);
			   
			   json=TestParameterList.jsonReplace(json, storeValues,params.getWildcards());
			   sendTransaction(appBaseUrl,url,json,params);
			   System.out.println(json);
		   }
			
			
		}else {
			String json = params.getString(params.getInputValues(), "JSON");
			 json=TestParameterList.jsonReplace(json, storeValues,params.getWildcards());
			  
			sendTransaction(appBaseUrl,url,json,params);
			 params.setString(params.getInputValues(), "JSON", json);
			 
			 System.out.println(json);
		}
		
		return null;
	}

	
	void sendTransaction(String appBaseUrl,String url,String json,TestParameterList params) throws JsonParseException, JsonMappingException, IOException {
		
		ObjectMapper mapper = new ObjectMapper();
		List<TollTransactionRequest> tollTransactionRequests = (List<TollTransactionRequest>) mapper.readValue(json,
				mapper.getTypeFactory().constructCollectionType(List.class, TollTransactionRequest.class));

		URL wsdlURL = new URL(appBaseUrl + url);
		
		TransactionPortService ss = new TransactionPortService(wsdlURL, SERVICE_NAME);
		TransactionPort port = ss.getTransactionPortSoap11();

		for (TollTransactionRequest request : tollTransactionRequests) {
			com.etantolling.fastlane.sandag.tcs.wsdl.transaction.TollTransactionResponse response = port.tollTransaction(request);
			try {
				showSummary(url, params.getInputValues(), json, "200", response.toString());
			} catch (Exception e) {
				e.printStackTrace();
			}
		}
		
	}
	
	
	
	@Override
	public void showSummary(String url, Object parameters, String json, String responseCode, String responseBody) {
		System.out.println("*** ------------------------------------------ -------------------------------------- ***");
		System.out.println(
				"*** -------------------------- EVENT TransactionPort_TransactionPortSoap START -------------------------------------- ***");
		System.out.println("*** ---------------------------------- ---------------------------------------------- ***");
		System.out.println("*** Request = "+ url);
		System.out.println("parameters "+ parameters);
		System.out.println("JSON "+ json);
		System.out.println(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>");
		System.out.println("*** Response.getStatusCode = "+ responseCode);
		System.out.println("*** Response = "+ responseBody);

		System.out.println("*** ---------------------------------------------------------------------------------- ***");
		System.out.println(
				"*** -----------------------------EVENT TransactionPort_TransactionPortSoap END ------------------- ***");
		System.out.println("*** ---------------------------------------------------------------------------------- ***");

	}

	@Override
	public void showStarting(String url, Object parameters, String json) {
		// TODO Auto-generated method stub
		
	}

	
}
