package com.jsantos.custom.constraints;

import com.jsantos.common.constraint.ErrorsConstants;
import com.jsantos.common.constraint.IConstraintsBuilder;
import com.jsantos.common.constraint.ValidationError;
import com.jsantos.common.util.ListValues;
import com.jsantos.common.util.MTMapValues;
import com.jsantos.metadata.MTDataTypes;
import com.jsantos.orm.exceptions.IValidationError;
import com.jsantos.orm.mt.MTDataType;
import com.jsantos.orm.mt.MTField;

/**
 * @author javier santos
 * @author raul ripoll
 */

public class EmailMTConstraint implements IConstraintsBuilder {

	final static String EMAILpattern="^[\\w!#$%&'*+/=?`{|}~^-]+(?:\\.[\\w!#$%&'*+/=?`{|}~^-]+)*@(?:[a-zA-Z0-9-]+\\.)+[a-zA-Z]{2,6}$";	
	
	@Override
	public <T>ListValues<IValidationError> validate(MTField mtField, Object value, MTMapValues<T> values) {
		ListValues<IValidationError> errors= new ListValues<IValidationError>();
		
			if(!((String)value).trim().matches(EMAILpattern)) {
				
				ValidationError ve= new ValidationError();
				ve.setMessageCode(ErrorsConstants.EMAIL);
				ve.getParameters().add(mtField.getLabel());
				errors.add(ve);
			
		}
			
			
		return errors;
	}

	@Override
	public MTField forField() {
		return null;
	}

	@Override
	public MTDataType forModelType() {
		return MTDataTypes.EMAIL;
	}
}
